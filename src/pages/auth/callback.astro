---
const title = "Opening Mnemosyncâ€¦";
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <style>
      body { font-family: system-ui, -apple-system, sans-serif; margin: 40px; }
      .btn { display: inline-block; padding: 10px 16px; background: #111; color: #fff; border-radius: 6px; text-decoration: none; }
      .muted { color: #666; margin-top: 12px; }
    </style>
  </head>
  <body>
    <h1>{title}</h1>
    <p>If nothing happens, click the button below.</p>
    <a id="open" class="btn" href="#">Open Mnemosync</a>
    <p class="muted">If your browser blocks the redirect, you may need to allow it or click the button.</p>
    <script>
      const url = new URL(window.location.href);
      const query = new URLSearchParams(url.search);
      const hash = new URLSearchParams(url.hash.startsWith("#") ? url.hash.slice(1) : url.hash);
      const allowedKeys = ["code", "state", "error", "error_description"];
      const nextParams = new URLSearchParams();
      for (const key of allowedKeys) {
        const value = query.get(key) ?? hash.get(key);
        if (value) nextParams.set(key, value);
      }
      const suffix = nextParams.toString();
      const deepLink = suffix ? `mnemosync://auth/callback?${suffix}` : "mnemosync://auth/callback";
      const link = document.getElementById("open");
      if (link) link.setAttribute("href", deepLink);
      window.location.replace(deepLink);
    </script>
  </body>
</html>
